import prisma from '../../../lib/prisma'; import { verifyToken } from '../../../lib/auth'; export async function GET(req){ try{ const auth = req.headers.get('authorization')||''; const token = auth.replace('Bearer ','').trim(); const payload = verifyToken(token); if(!payload) return new Response(JSON.stringify({ error:'not authorized' }), { status:401 }); const ads = await prisma.ad.findMany({ where:{ userId: payload.userId }, include:{ images:true }, orderBy:{ createdAt:'desc' } }); return new Response(JSON.stringify(ads), { status:200 }); }catch(e){ console.error(e); return new Response(JSON.stringify({ error:'err' }), { status:500 }); } }
